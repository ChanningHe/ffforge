services:
  # Frontend development server
  frontend:
    image: node:20-alpine
    container_name: ffmpeg-web-frontend-dev
    working_dir: /app
    volumes:
      - ./frontend:/app
    ports:
      - "3000:3000"
    command: sh -c "npm install && npm run dev"
    environment:
      - NODE_ENV=development
    networks:
      - dev-network

  # Backend development server
  backend:
    image: golang:1.22-alpine
    container_name: ffmpeg-web-backend-dev
    working_dir: /app
    volumes:
      - ./backend:/app
      - ./data:/data:ro
      - ./ffforge/output:/output
      - ./ffforge/config:/config
      - ./ffforge/config/database:/database
    ports:
      - "8080:8080"
    command: sh -c "apk add --no-cache gcc musl-dev sqlite-dev ffmpeg && go run cmd/server/main.go"
    environment:
      - GIN_MODE=debug
      - PORT=8080
      - DATA_PATH=/data
      - OUTPUT_PATH=/output
      - CONFIG_PATH=/config
      - DATABASE_PATH=/config/database/ffforge.db
      - MAX_CONCURRENT_TASKS=2
      - ENABLE_GPU=false
      - CORS_ORIGINS=http://localhost:3000
    networks:
      - dev-network

networks:
  dev-network:
    name: ffmpeg-web-dev-network

